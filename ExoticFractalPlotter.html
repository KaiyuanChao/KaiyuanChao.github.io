<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fractal Attractor Generator</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <style>
        body { margin: 0; overflow: hidden; background: #111; font-family: sans-serif; }
        canvas { display: block; width: 100vw; height: 100vh; }
        #controls {
            position: absolute; top: 10px; right: 10px;
            background: rgba(0, 0, 0, 0.8); color: #eee;
            padding: 15px; border-radius: 8px;
            width: 300px; backdrop-filter: blur(5px);
            border: 1px solid #444;
        }
        .control-group { margin-bottom: 12px; }
        label { display: flex; justify-content: space-between; font-size: 12px; color: #aaa; }
        input[type="range"] { width: 100%; margin-top: 5px; cursor: pointer; }
        /* Teal accent for A/B/C/D sliders. */
        #param-a, #param-b, #param-c, #param-d {
            accent-color: #1b9791;
        }
        .val-display { color: #fff; font-family: monospace; }
        button {
            background: #444; color: #fff; border: 1px solid #666;
            padding: 8px 16px; cursor: pointer; border-radius: 4px;
            width: 100%; margin-top: 5px;
        }
        button:hover { background: #555; }
        h1 { margin: 0 0 15px 0; font-size: 18px; color: #4a9eff; }
        .preset-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 10px; }
        #help-overlay {
            position: fixed; inset: 0; display: none; align-items: center; justify-content: center;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(3px);
            z-index: 1000;
        }
        #help-panel {
            width: min(560px, 92vw);
            background: #141414;
            color: #eee;
            border: 1px solid #333;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            padding: 16px 18px;
            font-size: 12px;
            line-height: 1.4;
        }
        #help-panel h2 {
            margin: 0 0 8px 0; font-size: 16px; color: #4a9eff;
        }
        #help-panel .help-section { margin-top: 10px; }
        #help-panel .help-row { display: flex; gap: 10px; margin: 4px 0; }
        #help-panel .help-key {
            min-width: 110px;
            color: #9ad1ff;
            font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
        }
        #help-panel .help-note { color: #aaa; }
        #help-close {
            float: right;
            background: #2b2b2b; border: 1px solid #3a3a3a; color: #ddd;
            border-radius: 6px; padding: 4px 8px; cursor: pointer;
        }
        #help-close:hover { background: #3a3a3a; }
    </style>
</head>
<body>
    <div id="controls">
        <h1>Fractal Attractor Generator</h1>
        
        <div class="control-group">
            <label>Variable A <span id="val-a" class="val-display"></span></label>
            <input type="range" id="param-a" min="-4.0" max="4.0" step="0.001">
        </div>
        <div class="control-group">
            <label>Variable B <span id="val-b" class="val-display"></span></label>
            <input type="range" id="param-b" min="-4.0" max="4.0" step="0.001">
        </div>
        <div class="control-group">
            <label>Variable C <span id="val-c" class="val-display"></span></label>
            <input type="range" id="param-c" min="-4.0" max="4.0" step="0.001">
        </div>
        <div class="control-group">
            <label>Variable D <span id="val-d" class="val-display"></span></label>
            <input type="range" id="param-d" min="-4.0" max="4.0" step="0.001">
        </div>

        <div class="control-group">
            <label>Exposure (Brightness) <span id="val-exp" class="val-display"></span></label>
            <input type="range" id="param-exposure" min="0" max="100" step="1" value="83">
        </div>
        <div class="control-group">
            <label>Gamma <span id="val-gamma" class="val-display"></span></label>
            <input type="range" id="param-gamma" min="0" max="100" step="1" value="50">
        </div>
        <div class="control-group">
            <label>Contrast <span id="val-contrast" class="val-display"></span></label>
            <input type="range" id="param-contrast" min="0" max="100" step="1" value="83">
        </div>

        <div style="display: flex; gap: 5px; margin-top: 10px;">
            <button id="btn-rebase" style="flex: 1; background: #5a5;">Rebase</button>
            <button id="btn-reset" style="flex: 1; background: #4d6a4d;">Reset</button>
        </div>

        <button id="btn-randomize" style="background: #6a5a7a; margin-top: 10px;">Randomize</button>
        <button id="btn-attract" style="background: #7a5a6a; margin-top: 5px;">Animate</button>
        <button id="btn-clear" style="background: #555; margin-top: 5px;">Clear</button>
        <button id="btn-save-screen" style="width: 100%; margin-top: 5px;">Save Screen</button>
        <button id="btn-load" style="background: #2a7; margin-top: 5px; width: 100%;">Load Fractal</button>
        <input type="file" id="file-input" accept="image/png,image/qoi,.qoi" style="display: none;">
        <div class="control-group" style="margin-top: 10px;">
            <label>Color Mode</label>
            <select id="select-color-mode" style="width: 100%; padding: 4px; background: #222; color: #fff; border: 1px solid #444; border-radius: 4px; margin-top: 5px;">
                <option value="0">Default</option>
                <option value="1">Color method Classic</option>
                <option value="2">Color Exotic</option>
                <option value="3">Color Vibrant</option>
                <option value="4">Color Surprise</option>
                <option value="5">Iteration Hues</option>
            </select>
            <!-- Perf note: mode 0 uses one buffer; modes 1–5 use four (more bandwidth). -->
        </div>
        <div style="font-size: 10px; color: #666; margin-top: 10px; text-align: center;">
            <span id="status-running">Running</span><br>
            <span id="status-rng">RNG: Sobol (QMC)</span><br>
            <span id="status-temp" style="color: #4a9eff;"></span><br>
            <span id="iter-count">0 iterations</span>
        </div>
    </div>
    <div id="help-overlay" aria-hidden="true">
        <div id="help-panel" role="dialog" aria-label="Help">
            <button id="help-close" title="Close (Esc)">Close</button>
            <h2>Quick Help</h2>
            <div class="help-section">
                <div class="help-row"><div class="help-key">Drag (L/R)</div><div>Pan view</div></div>
                <div class="help-row"><div class="help-key">Mouse wheel</div><div>Zoom toward cursor</div></div>
            </div>
            <div class="help-section">
                <div class="help-row"><div class="help-key">Space / A</div><div>Toggle attract mode</div></div>
                <div class="help-row"><div class="help-key">B</div><div>Rebase view (make current view the full bounds)</div></div>
                <div class="help-row"><div class="help-key">Shift+B / Shift+R</div><div>Reset view transform (preserve pixels)</div></div>
                <div class="help-row"><div class="help-key">R</div><div>Reverse attract direction (when active)</div></div>
                <div class="help-row"><div class="help-key">G</div><div>Cycle RNG</div></div>
                <div class="help-row"><div class="help-key">Ctrl+S</div><div>New seed (keeps accumulation)</div></div>
                <div class="help-row"><div class="help-key">Shift (sliders)</div><div>Fine adjustment</div></div>
            </div>
            <div class="help-section">
                <div class="help-row"><div class="help-key">Randomize</div><div>Ctrl: history back · Shift: subtle cycle · Alt: micro cycle</div></div>
                <div class="help-row"><div class="help-key">Clear</div><div>Reset accumulation</div></div>
            </div>
            <div class="help-section help-note">
                Press F1 to toggle this panel. Press Esc to close.
            </div>
        </div>
    </div>
    <canvas id="canvas"></canvas>

<script>
    // Some dev servers call updateActivity(); provide a no-op fallback.
    window.updateActivity = window.updateActivity || function () {};
</script>
<script type="module" src="js/exotic-fractalplotter.js"></script>
</body>
</html>
